```{only} internal
```

# Sphinx Learnings

The documentation uses Sphinx.  I'm putting learnings on how to do non intuitive Sphinx things here.

## Resources

* [Myst Parser Extensions](https://myst-parser.readthedocs.io/en/latest/syntax/optional.html#images)

* [Docutils Restructured Text Directives](https://docutils.sourceforge.io/docs/ref/rst/directives.html)

* [Sphinx Build Errors like Unexpected Unindent](https://www.tarantool.io/en/doc/latest/contributing/docs/sphinx-warnings/)

## Kill sphinx process
Sometimes exiting doesn't free up port 8000:
```
$ netstat -tulnp | grep :8000
(Not all processes could be identified, non-owned process info
 will not be shown, you would have to be root to see it all.)
tcp        0      0 127.0.0.1:8000          0.0.0.0:*               LISTEN      20741/python3
(.venv) pi@gus:~ $ kill -9 20741
[1]+  Killed                  sphinx-autobuild docs docs/_build/html  (wd: ~/GrowBuddies/growbuddiesproject/growbuddies/CircuitPython/src)
```


## Autobuild
Autobuild brings WYSIWYG editing.  It is extremely useful when editing Sphinx docs!

I tried using the [RST page preview](https://marketplace.visualstudio.com/items?itemName=lextudio.restructuredtext) which was great until I switched to markdown.  With [Autobuild](https://github.com/executablebooks/sphinx-autobuild), I have a WYSIWYG environment which makes editing much more of a delight.  The Autobuild documentation is good enough to get going.  Here is the command to start autobuild going:
```console
 sphinx-autobuild docs docs/_build/html
```

The command assumes the md or rst files are in the docs directory and the output is in docs/_build/html.

## sphinx-apidoc
[sphinx-apidoc](https://www.sphinx-doc.org/en/master/man/sphinx-apidoc.html) is a command line utility that will pull out the documentation from the Python code.  It will grab all the files from the directory holding the code files.  To generate the code,
1. From a command line change to the docs directory.
2. Type in and execute the command:
```console
 $  sphinx-apidoc -f -o . ../code ../code/mistbuddy_code.py ../code/PID_mqtt.py ../code/test.py ../code/examples/mistbuddy_manage.py ../code/examples/mistbuddy_observe.py  ../code/examples/onoff.py  ../code/examples/soil_moisture_calibration.py
```
Which points out the output is the current directory (which is why we went to the`docs` directory before starting the command.).  The list of python files is in the `../code` directory.
After telling the command the directory where the python files are located, the last thing we identify are files we want to ignore (in this case `PID_mqtt.py` and `test.py`)
The command creates .rst files in the docs folder (that's why we start there) for each code file it finds in the \code directory.  It also creates the modules.rst and code.rst files.
This will create a [modules.rst file](modules.rst), as well as .rst files for the other growBuddy modules.

## Include Text from another file
[The LiteralInclude directive](https://www.sphinx-doc.org/en/master/usage/restructuredtext/directives.html#directive-literalinclude) is useful to place text from an external file.  As noted in the docs, "_For example, to include the Python source file..._"

## Trailing White Spaces
Sphinx HATES trailing white spaces in files.  VS Code LOVES to put trailing white spaces in files.  To change VS Code's mind to trim trailing spaces, go to preference/settings and turn on trim white spaces:

```{image} https://i.stack.imgur.com/hZrUY.png
:align: center
```

## PEP 257
Having trouble with docstrings in your python code?  Check out [Pep 257 - Docstring Conventions](https://peps.python.org/pep-0257/#multi-line-docstrings).


## Myst-parser

[Myst-parser](https://myst-parser.readthedocs.io/en/latest/) defines a version of markdown that understands Sphinx's roles and directives.  I find markdown much simpler than restructured text.  The challenge I have is I can't quite get off restructured text format because the code documentation generated by `sphinx-apidoc` requires rst syntax to resolve some things (I found this to be true for links).

See [Geting Started with Myst](https://myst-parser.readthedocs.io/en/latest/intro.html)

### Extensions
Directives such as:
```
:::{figure} images/SnifferBuddy_wiring.jpg
:align: center
:scale: 100

SnifferBuddy Wiring
:::
```
require extensions to markdown that the Myst parser will optionally handle if the extension is listed in `myst_enable_extensions` in `conf.py`.  To handle images and figures, add the following to conf.py:
```
myst_enable_extensions = ["colon_fence"]
```
Now we can include restructured text images/figures directives.

### Example
In this example, we start with a file in rst format and convert to markdown.  To do this, we use the rst-to-myst[sphinx]
1. Install the library into your virtual environment `pip install rst-to-myst[sphinx]`
2. Convert the files.  I put snifferbuddy.rst into the rst-test-files folder to give us an example to work with.
```
rst2myst convert ../rst-test-files/* .
```
## Record Screen Gifs
This isn't from Sphinx.  However, it seems superuseful. _[LICEcap](https://www.cockos.com/licecap/) can capture an area of your desktop and save it directly to .GIF_
## Cross-Linking Between Sphinx Docs

Where the link is use \{ref\}\`Custom title \<anchor name\>\`.  Before the m(H1, H2...) Heading, use `(anchor name)=` .

For example, {ref}`Let's make a SnifferBuddy <make_snifferbuddy>` is a cross reference link to the section in SnifferBuddy with the steps to make a SnifferBuddy.

## new line in markdown
I guess tools have a bunch of weird ways to do things.  The challenge is learning how they do them. From [the markdown guide](https://markdown-guide.readthedocs.io/en/latest/basics.html#line-return),

_To force a line return, place two empty spaces at the end of a line._ Then hit a line return

## Material Design Icons
This documentation extends Sphinx to include [sphinx design](https://sphinx-design.readthedocs.io/en/rtd-theme/). One of the features added, is the ability to use Material Design icons.  Not all are
supported.  Here is [the full list of Material Design icons](https://fonts.google.com/icons).

## Directives versus Roles
Directives work on blocks of text (whole paragraphs); roles are for inline text (within paragraphs).

